#ifndef tabulation_hash_h
#define tabulation_hash_h

#include <climits>
#include <cstring>
#include <cstdint>
#include <algorithm>
#include <random>
#include <memory>
#include <stdexcept>
#include <cassert>
#include "abstract_hash.h"

#define CACHE_LINE_SIZE 64

namespace dbindex {
  template<typename value_t = std::uint32_t, std::uint8_t _num_tables = 1>
  class tabulation_hash : public abstract_hash<value_t> {
  private:
    struct alignas(CACHE_LINE_SIZE) tabulation_value {
      value_t value;
    };

    // Chunksize fixed to 8 bits 
    tabulation_value tabulation_tables[_num_tables][std::numeric_limits<std::uint8_t>::max()];
    // This array should only be loaded to the smallest extend possible.
    // I.e., if _num_tables = 4, only load first four rows into memory.
    uint8_t num_tables;
    uint32_t tabulation_values[16][256] = {
      {1459398861,104521006,3435567986,584822706,1903470457,2020624129,1089039916,1363585707,33588150,2356945208,2123176382,4075525412,4022065251,3235769022,2165164199,588329530,1712382454,3925237856,1935528592,861930535,2532284864,2640765411,901586793,814799306,18732786,2394246692,4239316660,3421678381,2225428448,11628462,2935796001,1163496772,1574994438,1273124661,3148748494,3933186890,1237255762,3018656391,1646094143,1749175392,68449462,3534275124,1475729584,3656799601,2786235099,122318149,1768155730,4230731831,168969120,1268516064,1845059682,2694799529,3222946868,2733572304,3196541728,2848771827,3124741402,1455391641,4088958405,744738903,1397110160,39288462,805851259,2592551486,2420577962,418065152,2810760781,196097792,1452579737,3018176442,3401886427,2594122537,289869759,1489431100,1067269516,2716314435,1615273053,3889052373,233762966,38110761,3027745064,294989617,1820448337,2806076574,131385238,878176719,3373866139,2909644710,3158891713,1895531231,2413471221,4232176897,3423567883,1668219404,4288566827,1742740979,2740350344,3042933568,2801390853,1199642446,3741642687,3744343989,3345066258,226862075,313266939,2736728813,1169068859,1359097202,2474822309,3075943700,1125685035,972314156,2305198522,996290883,104785158,1913873789,2291113699,992842937,4197382587,2606016893,144949634,4223971547,4089186928,271955425,3575852381,1563674651,3719861825,2510421048,2199695761,2855066660,1522983978,1589797931,501331288,225891783,144101085,213128390,2077987249,230425161,2412410680,1764451810,3466010694,170757090,1045465455,2637961309,4167449656,1445362013,434826489,1380249390,3256494904,958477708,1358329256,1763254253,2950762110,2895634000,2459122918,1614679869,133963221,3586855906,3630998657,3294267967,148696276,540599865,2025334434,702114740,313846570,2800913569,1417527420,3109968134,2177947548,1730967545,312928738,3902318899,2066263072,1529036803,213568392,1851081645,124454078,1674213961,4189887326,1082940137,30745022,3273972131,960023667,1780471352,3778718190,2456511261,387816263,1414823072,428585889,93870369,58305049,2573654991,4068567605,3148251465,2675632486,303195854,2597741588,3756476778,3213369380,2925459982,2031423022,3107688663,2784921806,397594013,3953345489,3605770606,3839510937,4093061458,2158272102,2422575509,2878661031,162153990,2983485615,2032851423,1104062684,3042399330,1038438873,1172184398,220549869,413414399,118731318,1322552964,1495547614,4125061929,97961732,1982455721,1794673499,1020062733,2548145478,4193354605,1544576427,127452166,929192800,2553635208,2312911514,2444028430,325905337,2774018466,3453144574,3293745946,2181954356,1331364212,443181477,2467379647,3626111230,2897973479,3991837956,2026499778,3387535805,2611824026,1624923696,2648520048,93164681,32410893,621314000,1817629163},
      {2609752741,2360932666,1104415025,1623337292,2588864333,3335532330,3718342868,2594250705,357934358,2686425444,336092127,3410796166,1211736330,1364012647,1433016805,3393445073,437559843,2592268585,3568924845,608994031,4026763922,149892006,230055222,2441921520,204638770,3018536415,3711619110,211165994,2224976167,3309644640,31248697,2108381878,3989658098,3186398285,3106959562,2463720378,2824662371,509657937,2692358157,660368102,2007124094,1412082708,3273632168,305896552,903661350,350146573,2700598187,2213019936,1921159454,199659955,279329478,659537289,1670445180,1362117629,3759081174,1648625121,1990226128,302871472,2498129675,3005199583,26246534,1703411185,101449492,134294347,2820971528,1696846661,115241746,2941287052,757347854,3025749607,2617245038,24329763,2121868179,3404231670,2210748688,2445732015,738911517,3186566923,1407323460,758296143,789755631,57477595,2908434584,711345989,12020128,2594064172,2446393760,762688208,962328814,3723897114,4164895723,295257965,133994457,2405071226,95912567,2416999143,1579816136,3256353269,3241953445,2611553097,243219669,42362096,1718332062,2523247866,3255449895,3651170308,1733589347,2185334892,2522094439,1903135584,2908292542,846128262,953365141,206948915,1347968641,3454392688,2634326489,960360318,3935164847,575231547,3267378809,2759597548,3540074160,2009753372,2517248224,3525227242,1639692769,840045813,203083802,369514586,2429128263,2621684590,2532727954,2781028869,3765420939,3433342498,2555194147,3822639474,3900269409,207509256,88874317,3721462998,292786027,1820637519,1794840667,3217023492,494458548,670723752,1867196946,72154075,65631193,171327311,3691944331,2604210761,2654741572,1747828673,852284442,2766379344,3061956363,1043361578,4183031054,931236892,1289750901,3502127281,1166894515,283231123,1211111043,616212870,3842820238,3054663310,818198647,3866038321,2300982892,1330170238,908083617,35965797,3609860593,3696992177,1643242570,549314206,611891425,155002725,702086279,1439287745,627180657,3812110497,1734280002,3023852504,4203426529,1153779572,2987917943,1728725167,1398243484,4101565711,127956277,669919795,285472607,3300757222,2030061883,756322674,1192076166,3961954330,712667927,1774452217,261995880,610617717,2970180028,3007521498,2277967676,274530600,93606786,941760731,111733560,892371471,392753491,3990038288,1208812567,3907727595,4184284780,2960858312,4177465849,474925163,373308223,1177674468,356906820,3670420256,4066264557,241247383,3219468782,2722212996,3165861224,1403946830,3682855165,86521620,296357707,871560108,2334126001,1960678469,2554622259,4236557550,646949320,3393759489,634392319,3255758056,317722898,3537920551,362898950,364264574,1355894015,1019893728,95712171,2145644461,216636986,4263692234,3101440884,2549634782},
      {3770391511,1141635526,1343629720,2926826895,554567050,1666085495,1620420457,1986555172,4108039767,571629047,905875404,3021893467,79664708,3048028360,1404520544,421953606,833285954,2201975608,499489739,1497180054,3658555236,3534484720,4193475515,2943475683,432475408,1185351917,210866054,377877556,1153847575,2379016126,135362021,4108164135,886512096,2185319453,48415139,4274343053,1718324911,1573810798,1925380213,2277127535,2279359353,2319355413,1135051403,1832213811,3979235630,484557652,2310734871,3074019678,3250124991,1987522439,2363742903,2654855694,2279446733,162501034,3184043504,2890479475,289828464,591171665,3887942283,1417745661,222113293,1980935395,84071469,1995238646,463790344,1073371691,3982827499,3513181583,3329667868,4223150450,1040881769,735816676,2910266069,2655379856,2191177436,3519628924,2056172509,318747951,3080358467,1628835365,3818810874,3440028434,156405087,3559789844,2551733968,3145480755,406261587,1967815298,2783928157,334239240,2354853782,19272048,4260055788,2093765568,2942641269,1878069361,2512086197,653037357,3201958136,709242153,1998865692,1359732505,4209553851,3275663118,3549463831,1839645599,2515047108,2278440544,3368050793,719563958,3971796412,1899374089,1425910076,3400777421,537289133,2789530869,2332249346,2035450773,1802183041,3481911723,193464917,2109277597,1604852354,1792125089,2476654009,1697628746,1518222609,1934814497,1242130295,1464445945,2316270934,296248760,972760860,1981198078,806367899,4158345037,2883133148,2080650340,3428485489,1133814759,283179120,884791178,1116476312,223077758,1937585933,1572910755,2063061115,3208787139,2475061833,2799583524,3304880388,2653640587,2091185456,2208440152,4225835502,231250728,1047043540,726421904,943546816,1263943801,81117656,2827721108,1719889229,3277560796,3417267972,2429613339,3707941467,53331149,3250770982,52231644,4240991265,256195314,2435637929,196558915,3388862696,3213678916,2250666587,2276684433,324788338,669826781,3324446950,1198322471,83983697,1603674090,2694299894,2782354689,1395013208,39408318,297667897,238541941,4210711016,2622264500,3367433204,4265065452,2489619059,3581864410,796833663,4037268085,1839790817,94936501,3016727853,2907075052,3330572199,3469958610,4248195877,860924719,3879698814,401278272,257834377,1885969667,3604391929,3870664918,1987425389,1166323790,1286091061,1645317803,1255610207,2961883154,3517128104,1033227764,765680094,123527916,2653715620,1765746062,320536673,2540455894,2780168017,1520144254,307843414,31051440,1940950088,677690223,717368997,14291056,466355136,2345694477,3224327722,1294229417,3668874900,759628152,15717100,3191198837,2521157825,106733112,1030112779,556779312,2263862683,1629887628,3297992084,343502334,2882249229,1382355867,2199459373,969929570,278824915,3570570128},
      {2372093988,2318596570,673613323,3279819054,3656963314,1142134787,2994649749,367111077,3529293715,2098551288,3198038333,4188781849,341167347,3388511486,2757524011,1122119971,3745029414,128565520,1265198980,1561690160,3710732866,2379342972,3220099916,3698976131,3202284032,1657112017,4170770182,1049375020,4262743923,399525484,166492532,1647660650,90730739,2498381643,1484470247,3663682718,4003939941,1385816348,4211429176,2167371802,4107658082,2834098491,3338174899,1661618345,56212602,167588653,602092939,2906677835,1286212118,2836450270,2427384523,35848034,1631653296,36255147,2538584765,1465612762,2853451627,743643415,962886584,2108170951,3189461714,2394796022,3643323757,2859980524,58354797,3859856367,83085603,1962057684,186076775,436215341,841010755,2773347855,1016346822,26211921,782955776,3366861668,2900940018,2851066164,186128401,1223954830,82364929,99261874,3553117744,3362779279,4035814107,1355530359,1626362320,2270691297,2345167039,733790961,1460433020,4104952748,3555136140,549266430,2474058481,3700851221,3985549627,1456018556,1296775042,197836981,3533346319,3224663009,2277347261,2131450637,168997433,3316235075,4228482379,173147211,4023884480,478851042,1127382197,1365717900,933326381,482034807,1142295370,1953715641,1703856979,2000245491,3147528963,3677861059,911388441,1531347690,3391061528,3336436154,4241436381,1880760481,3043343460,2477918250,3806283076,454318240,1599683573,1975469137,3194097670,445649837,2845259822,2996442216,283310583,3984628655,307524251,3966115826,840722496,391929359,653586774,828212623,1291146674,100005632,1037463523,2911468095,1044426994,2323219261,3620158049,2591614366,3184946711,1153227142,260926584,190652984,3234950952,1922055904,2364681277,788421484,1297936296,446670245,2325357709,1029141556,2837762064,3328751946,24892446,2175128303,4233603,2407112199,3057286091,1433668776,4058064430,3399347411,1365644456,3720263764,2162069376,3745181351,164898129,1548766545,1360659,3826562193,20474823,3304933364,3900264978,276132779,3899020809,1151087487,237184967,2016080388,2267077916,1509213080,629920940,696614986,1680329956,3145222506,1044628458,1430878538,788843780,757048831,2890338808,190465936,116296329,2258990127,1138032489,1839914346,200398572,1339723396,2419898433,1354865529,1622234171,3218457621,148708411,140104123,3221423806,1199051121,1627881215,3743729530,898562703,3690215991,19790120,3392376421,1929137704,355509716,1751527077,157642015,155588082,1212442546,1605676583,3649474408,2497140677,3735476472,1801894941,2334645957,1958415580,1533520695,1087530871,3972420508,3592272809,991792053,2672629832,917723181,2061315301,2340059950,1746624501,3841611035,795039421,2385474245,1766077815,1848346419,1619297340,168252672,963071576,4191635125,3494716364,3508488163},
      {1296952686,2296167947,3370037331,2388827989,172536672,1805866768,2147065917,412588945,1438372719,399679220,1404680214,1111441811,178971943,1192581492,217254005,973492410,611097672,163993697,2121030678,1902199394,217445817,3826450009,741797931,250999811,2108520642,407969992,3020533079,163326906,1595083857,2129480343,3800463276,1049216248,141628290,1783819918,305865633,1108588096,3943064749,359567163,1367545514,1672818847,1314985589,246016450,361678006,778563645,3609527745,1473878261,2746259421,2301227662,1293828716,196164698,370803805,1201422466,613661480,2100566293,1332693905,1058644516,1033647180,524918025,1904318171,1270733666,3669955529,2318947663,4065750646,3079036685,1263021412,4070594754,2744261939,2281322901,1057774028,186303214,1787950507,3269865214,1870013170,364559822,2289425423,393487525,3955013093,3213535453,1005715847,31289413,4047868063,161616088,1919299934,148520727,1281120073,1624799133,2910951626,2013333975,3817241747,305803685,248369456,353389907,411896234,863616128,1195862365,1643871813,2042058118,2607288141,2049633270,4220969151,493519229,2704312715,1381217545,3276837400,227587887,1656013126,4205237681,2649777309,3373379213,2255687291,3678041312,1623358482,3085812027,3204021035,1215294351,600571845,3862612933,3778874726,230338155,3546690003,199042109,4144369555,932180140,496690357,1710352269,1017487913,1710682270,2489324629,1809093824,3948070741,529813753,1104639174,2596010117,2061723505,2423868424,1933421905,3844143252,2227689061,3477960933,4273421337,4210653540,1717387914,1569550097,3868261769,2384838759,3269998981,2358640824,1068039524,223451295,181291793,1164841003,3918832984,718761426,1386024401,2871696076,3492988312,2287169658,399918524,617056572,1614769332,2158789412,766539415,3912114814,943134764,92991211,1586644028,639824890,251199429,1162932869,3936163289,2521418147,2422174109,4053144852,853884799,834698291,1055787001,343691619,516568770,355789447,2072279758,300356983,1557915766,134925756,1358623906,2461373074,1751658798,2325084430,221155798,3047639127,467448186,853747163,1645871276,873722787,337317504,2198350771,324498217,217286007,4102248275,4149387024,2994078314,1464842122,2813861625,1407561944,1971888754,3743498527,12417371,3970352931,1581543134,748439587,2064852959,708948336,83343599,2592363273,2733194850,2282525034,3627943141,3739968392,2499648351,769621898,351935972,560838129,3474554287,3403792832,251676250,100057009,3912852321,3866494761,3335574824,4066981057,1436844088,335469141,58562880,3066583244,4048775069,16053955,1456986740,2566460264,1800135746,2831799735,2879263850,417889297,1559085157,3648417233,177082801,2000642582,1665054731,3075361989,601175304,3385879381,2515591888,2397125850,263152,2551769951,1396319243,1117867062,1308915381},
      {872350980,2075134046,579288169,31360034,3401336280,4118561352,269879334,1659533257,2834219199,4172190223,1137090533,3957935100,288469146,728849903,1933193317,2225989197,3188855470,637318446,309281116,2592972858,3046873981,2667823902,312227827,300934489,3107432272,1904373151,946211581,3780855264,529944616,1776747510,364146696,540348524,19408,1191087861,3849357833,805922207,1097123212,2273999802,137436862,4134869132,1241175936,1361090649,3682526617,96190930,3232340023,1092328338,89299194,4124960325,182442045,2339883468,538964033,651553797,2012239350,3890539635,3558886277,2803116079,3277523554,3374860130,615692843,543927829,4155819706,2809839601,3702959361,654163321,1420887947,335467916,2280761484,581822645,2550253368,3131599941,19035433,2235519057,4228869302,231326967,3023590605,3810782862,4023530821,3886628849,241673823,3798126649,724094030,207742764,1179565976,3214489040,123819026,35748760,6978739,3131957957,4294873353,3620837417,265934054,809166839,84596005,3705913638,1329262550,2456054646,3090164698,629599123,135771554,355604197,9003267,2761437102,2308950151,3919156756,378289338,417013727,171395622,450872691,402048325,3428896346,28709275,2360886484,541453590,2656735308,2582374312,138618430,276784303,1743166405,4125868078,299320025,410552833,641878059,413012731,3362835461,2662213902,900549194,4261847525,4054597679,128985839,3293785973,1682749884,1619343581,3582460173,73183730,1488845133,2727792190,238629390,2605412883,1871232298,3160315051,372099085,3651322971,1702451539,998132327,24086894,886044389,3483269500,261170870,4120866505,638558823,1643831019,2872199006,168502546,820030916,2440778661,2410075413,166048362,1674415439,1370277989,1656613964,3038327213,2599999975,1054614196,360512685,2828022515,687479893,1092520364,4104711598,1815942615,156134366,2148737497,1218169016,3931732165,1342280188,4226644940,2705322677,1636210564,1876358405,2322843456,708234774,3097851810,1488758137,1099688081,235161979,1262014823,3438985742,3938297406,2230591942,1123649599,2403191066,1758726530,3895120682,2617260076,696289254,4065830806,4121166252,1120410813,2873127756,3586099833,1637515965,1872854198,3109892912,2866898736,2501728177,3350087131,1025091947,2222248265,1569996503,4068911974,1358913107,1181366663,2935832017,1571035473,2947496512,697261498,3095231643,1828327588,728669522,2238226570,1211863534,667936857,2701466237,3128344512,3765668857,2118036341,326274778,2536473287,284048657,3300172434,3325028690,1173824713,695337180,5161687,587336722,327360290,2520444315,4018441898,2600868975,3079126639,3445789817,1973685286,2072394933,849189693,3910753035,3072933538,1921174368,1711649325,1992128758,1620158732,1485643787,1115569306,586089701,1049383244,353293063,454487181,3249044859},
      {2299680911,1626076453,2006879861,3361014235,20993943,808987261,620612261,3590767568,2576028489,2829633,1005218739,909115453,3100081718,1127817894,1654018793,3190955241,4234187853,3724986174,621298742,44009329,2896460146,2157628625,69797088,989052036,1018632382,3322959808,25423149,3903946970,1010463609,1563020813,3412466420,3456619920,322376822,2286453256,2367631829,1957991301,2181082279,3201476293,415784808,1041246383,3436371889,4191595585,564464269,4066757407,266049237,3593068841,168947527,3708144069,232578890,869178532,2465564329,3704086546,699720835,600230608,3756142445,3294564299,404181619,1331117014,2772316571,1897137330,1332269907,74422577,1609451112,373628279,3215093793,3438892831,1220217933,3032110271,3585778847,994736953,4230334182,49474072,1224461972,762780440,186528663,2241382275,4238346128,293971691,4267811281,3541543988,171336956,172434259,2517914440,1951096669,3318989814,1909975172,2308522763,2846650261,3909024097,3759376738,2477217621,2982424719,2067835824,1184874991,2246239741,2670069223,751835525,2402847343,754350545,694545697,4156244923,483057545,1274473109,2234974259,3757214559,4041550249,1904777130,3255785825,624993846,3314718373,763157151,2449849782,1202982899,1044926860,1196595385,2086659962,3815379283,129763847,2002035939,2867060906,427634966,3920177409,682947682,2972196517,832179448,2785822747,31425219,4105465379,3200786152,307691035,2681723793,3073337987,2490321781,3813143544,2505472641,3546485685,2895268624,3169074830,589851444,892621164,2102656272,1194766585,1259763211,3065065273,32943863,4220628161,4207764659,1145560514,804587217,2385913182,19498406,3733730358,965499695,1745371796,343013021,999523123,4041928642,2290949219,4163751089,2995460207,1276722726,3250614426,1186539209,67344057,2283478631,1329012995,1787917667,1804153433,2074261542,3345684110,2066294790,903818964,269978753,2175171765,2923579807,4131086788,3653959101,2712365580,984418531,1114533896,642615943,3288596156,39757630,23715665,253695792,2904474407,1575483116,830528821,2298738932,2312928970,2654931019,3893510130,3140613624,3964157129,571558994,2271522080,2562035705,857226300,4283476719,3263146570,4105782329,349866661,721624656,683725739,1813883858,340340538,411328933,1469139496,3672340506,2716596830,667523733,1912927395,2246472987,1829074311,2966546021,3583694043,253222999,35716927,39031032,3801596695,4136612102,1558713158,2211667770,3190591401,2420673781,80343374,2318015276,240566055,3154519868,1246799071,781740525,3433078209,385737511,2504885385,2280682656,1914146602,1723065845,1001561663,2748726204,172561698,4249953873,3195489685,282931964,2565230377,2327177125,1976142183,2664493222,186314716,1093587592,2529619908,3969951684,1753769933,3420866887,1063011535,1765954810,4220735601},
      {3995028783,81659837,2066721475,636843429,2653321549,157958298,3960625557,3112760340,3541347515,600926850,3353611853,1964627909,757366375,290658872,3662319961,1806837344,2830261289,3680389695,135623369,2520410299,2266646707,2122653575,1058676880,1905062414,939656041,514280791,1534057877,4250622513,3884286363,2794218138,147843335,1640431565,876721321,2082785686,1419787233,337924339,2882191187,654345507,57961847,3679976188,4011097151,2015575692,4157216500,343125868,2230776629,2332429519,296380575,2719228436,3205750567,1863846060,1174130153,1998057580,133629488,2761096606,2203559897,2716079104,1512380399,423017089,1572512280,409659096,1750778259,1309137611,3164591835,2586681150,2276474104,1906998068,1556861393,21154237,490074589,3511058180,2436543328,3159244350,4077429332,2464294128,3591457801,395160555,1160929883,261541994,553979324,2637484221,1305880131,2289733289,3713630644,2223395013,1934743605,1467489558,2588348147,67986644,775587881,1355687268,2476546608,874310752,3805034272,137922551,4083542793,33948400,871732090,1267192145,2744173789,3748464759,1139194321,2882813468,698994223,1702230658,828037070,3552052891,331393919,1946272355,2246136035,1784884739,2222744229,3216078800,2518018111,395865026,270064779,1758061901,36857017,319245766,2970626746,2606239934,28196045,4285418033,862852643,1835925427,1538871206,278083944,2404120188,2216357390,2603221207,711959691,3346798550,2203955892,2335589660,3144797477,1434233151,442815773,3090113852,476847952,708152117,1058139042,2575765722,1897948181,4267593460,1347662817,3948853726,1769883911,1617776354,391355011,178419427,16619090,2147816350,575054766,1290114285,2058669392,2784467245,1207993541,2003493688,64713218,497349334,1932279864,1208963145,16468662,1285564824,3672719924,2716454595,2144617155,1253791761,939872984,798291887,273187258,3890628744,1912449670,115576497,262897214,308016688,2144449819,1358536973,907022918,1857424580,1798132441,1672623404,1935721254,816184411,233102693,2438356192,97263328,1178624553,2656023027,357488903,2545394312,2680894221,124909090,2848245998,2689771074,1249857577,2993097927,1823539682,2961292871,3175898266,173119128,4004171128,621556470,2100470165,2230312956,2727183199,2664027842,158116054,3432145779,3944649858,3967492986,2985910297,417947689,3531080282,1337914224,1785822204,487291514,4082573360,710790277,2004362487,3574125868,411276159,1459077658,3377584852,3449899554,2093461741,600091404,395887209,529826629,3369830922,3183221161,4022457853,1347550642,1375381660,1892775702,1088490635,4234774348,297247894,3769979555,1602458862,1507514642,66838927,1027313688,828186764,2997745690,3314268697,566966509,3011089434,2158347225,4260218700,4287398775,143407945,39536664,4084818112,1672283191,1164613347,1975227210},
      {2708410625,795164077,1470941556,3517075570,565887716,363957230,1694394977,1785885922,3744534963,3418619006,2658614893,2626725058,3206972405,876664211,1715483163,3023517017,400683366,2818224951,3816245711,393599298,59318838,3381064454,2110123393,533014097,393377818,334508527,1940463279,1997721339,33338751,3121838660,302721974,3260820870,4190770869,7624832,3936626281,1712897150,3011235747,3792550728,914031364,1267439872,3982214141,707238014,3606324727,938544558,3738262033,2759499118,3754713484,3215536073,1396076409,1342271581,4095097249,2368258025,3298621045,1631961481,3293655974,1846142991,1996667141,605322275,1891295838,2752812401,2626451037,2824579543,3760285314,2415665006,3861347103,1458795869,1949329953,681323162,3282349068,65939209,340185310,340967136,2685136414,2299017064,343418118,4278168846,2006770215,1765081870,1251527023,3841593313,294799485,2112338472,3517554205,2414936582,609967613,2664972420,1385436710,2976988143,1634483982,3209785326,1735194805,983366036,1261387646,1515044,2984499063,334181674,224488533,404125037,2700261866,207135340,1858988210,2033684506,1657878568,3061183611,633080570,189640926,1321023499,373161108,268563917,1592448837,50177654,24221197,2942927203,4156339755,3907222340,3962217860,3364720913,3799492240,1366215678,827497095,3624253191,753153367,3948598711,616140192,351962858,751594407,1942367817,311758749,60329620,778092569,23861595,3073254212,3967923918,1431998603,3322038019,276353793,531310272,1388923985,3876734947,631817169,3152055831,1583373566,2915158582,3128334359,1104889317,1644633983,137829881,1761925366,3490838314,435879934,3544052790,1590070933,2278635969,866497821,787849514,3923975245,3021250073,3804967,2764271535,3819198722,431939556,2503563355,3743916972,3574513268,2217389634,24318179,4085278703,3615776546,3167215818,3078372084,3480016440,2015953061,187336723,3323071986,1803199375,3448228344,1563648898,1628215686,2761757770,2274878421,63934926,3959938567,425320599,1131425985,2437685205,118419991,201427863,1608129855,3282834884,2798240974,3638773862,3953192893,4108972052,351607689,993177512,1379263360,3388420656,203679832,3296351467,3799012004,3305579121,1877866226,3116639505,1531468265,3177190994,1810488598,1506513727,322455928,910894992,1870952813,1849958082,730350305,2933646853,3166515560,3430253857,2087462277,2801054150,86591967,3898941862,208281068,508174756,2780980311,1488978736,403674161,704926322,3457115165,2597616247,2647352844,2300820979,1980344848,4014629850,4189286949,149195028,2754011942,680747806,1645384897,3330188960,2866157829,2229766323,2760647408,756343586,3977926293,2439669817,2898531611,1534776515,257383769,1908820889,2060584237,608875226,347212509,441989221,4223321445,3322694097,1398674329,1364880296,2195844685},
      {1608368688,1852273114,2681339637,1708730826,1093033405,2880941149,2482174081,750642460,1729197820,2796418080,642852383,1076338488,533659926,2218938969,1953659030,2509631863,1530727327,3482367137,364251587,3310366496,3031676459,1464814096,2953741642,384923933,3615251974,1781287581,2748441965,344412240,801061963,4037661571,2638724426,1498794969,446210758,551422772,50164296,2421256414,1933823758,2807086835,2105443505,2045834158,2952521842,549855440,429741936,4253190022,4111852147,1480284565,4206134351,2631172020,385745000,3507353263,2069186583,528145739,4021847725,1997826299,4268732085,4131915317,851034782,804493148,1390852820,2967225931,82199231,123080494,39462342,1915165277,1321224589,2622195756,207944717,1947038047,865298540,539528084,3742980919,7598864,153375777,2276774481,2797185575,1549347179,710499734,194578006,633331966,3955317025,4137175079,3755889106,1741444085,1349968424,1893668312,2899120315,1193789110,3491330680,2496376286,2598755582,2834011751,1909511523,47617504,3495818757,51326519,2813448491,52671739,3534592373,1345595768,110663446,2996037110,190731241,3801667606,1390321186,2241780299,3714552417,3698051676,2284429513,2424437031,844122194,1083997170,3176270995,3750849341,1142560941,3961366756,77637904,1903427902,1373878733,306179468,1794637278,3828885262,2567330858,126968677,601362364,1708364805,383316120,3894897704,1193890663,2639335444,354987730,3803949000,718077520,249721457,3981723637,324325745,1389073718,1285916919,1246317863,3640833295,1858242855,1088339350,745612959,2708713364,420036361,364261936,3951755820,3175073896,109225813,4293038331,345250764,746914234,2468198878,1451411647,3279099071,910687174,731088189,2356192259,3859677220,1371188020,1842856839,3065831734,867468208,406916089,2388477713,169474239,292954850,2621289,2551368602,4458093,2514123821,4225739545,3132343987,1416927528,355786779,223614196,4173661081,354329890,2282749921,4178381934,813171854,1551265445,1822163646,3895641003,103184968,1753264050,2202679903,1234299286,44665411,3604060068,2142038018,349534886,2512564596,810766140,996543261,853467376,3335053605,1044244679,395245926,1673585731,238029365,1430819657,1203272270,1587184524,749337788,937460020,413419516,4607446,1632455472,3453310418,1605698910,353183061,471082408,7483172,1266520384,295312402,150095579,2288197905,3382029135,1353478793,202887173,3743014260,4161017784,2004064202,1081746709,2703316783,3811114718,2555768846,502346150,841019010,1961676707,2216819005,385555663,4193454250,401397384,1788083168,1938495511,157425455,3930174786,3884884306,586646801,2381328762,2524278269,1314132474,2534780114,227286663,168492013,82210565,84155447,4145580943,3713474073,3455317576,421277502,1206894656,1161251700,2166085585,1657592460},
      {641532554,2578484367,1059741154,1627526408,1892759570,419909525,1561356265,1080735444,1711832052,369332682,369904529,2675559370,3801775272,307433295,2984736738,1861480837,816582787,1376557237,270882023,2254826748,2908139542,1170849826,3440098736,392922622,1948887491,817899480,349282731,2601171909,2648151991,1811070561,1616397725,2962594479,551682463,2069262439,172119993,3660884168,445642226,1013960721,3669245088,26021326,1463747324,3778594907,1811495662,582111541,236169937,2753285491,3350669441,3453227051,98711924,230928972,328118857,1787975649,691137267,3923098199,124622051,1468991129,308513362,3676220375,3153728504,3645343604,2447758375,1884024965,3376995362,167385050,568799530,696378784,2342691869,1221369306,4180375601,3729942787,3188496252,2033077982,2312849820,3717612689,3153824470,3363393273,3261770055,124661643,14290701,3430910526,437549090,2289384739,4045653660,1514782749,1423413061,810392488,124215700,362327516,4050529039,2722322361,2557480308,42581857,3314393988,2541363590,69754242,793677078,3622294649,3818734527,3221557005,2164781453,2970655051,113339197,3199510600,2450427920,135914818,3353835840,1842819672,1195973841,129747637,2120474114,3537625820,3585649064,3852684638,4129649656,2680486023,964635773,1804353088,3031168605,1862587287,2751520629,178839138,1287477510,1703751902,2860948734,3532873791,3129224314,1557199999,2909881369,2817090328,2058365772,3954530017,144129465,2241241728,3626395464,1726681396,4213710703,87264172,2370761673,4058094132,2464969392,2192680088,1185648614,1689171602,3229044065,106118484,854940930,4101061018,1053576312,3115893643,959263293,2108649712,3578970310,2305952022,3722297921,365694650,3456025171,1367766629,2842759962,115562247,130786973,362694015,180759518,380414798,2001849859,106664427,401031039,3340017272,3682181869,1453592634,1937125223,246714502,1131466346,4114861591,1030619780,2514520413,3068985608,2961260864,2130667006,3880867857,3558147220,110095152,1667142824,2228987985,2394815578,375794967,4029749429,3533746290,2833895534,399479010,2086886197,1916274641,3337924700,2823011577,2843071432,3370451539,1355890716,4232523895,2352711950,2069736292,2127970893,2441629754,2042342366,3816587327,1373040472,2219763506,3393151932,1986462144,3377646286,1700121280,444481957,877286346,2710747362,875158102,3883536678,4005790226,3361660978,689232752,4212453790,3404232599,3347055955,3910881828,3428311872,1643833332,1319493228,3235388110,3149789312,4187325489,3823230763,886993688,2876534283,3618632696,1381574203,312853530,5313327,3400782174,4146467740,221121402,847334465,2373329539,3860156826,2398645516,4251947748,3110484610,3938720259,2444367230,1482782568,2656444720,3866433204,373688243,3693368822,1123794603,1495317881,2376317413,1298751277,1806121337,1256860317},
      {543210919,3153482104,3630825603,2291318546,3955116668,2460173602,3589580771,1981869062,359214458,3809766476,675782071,56519870,3301128831,261219029,4251458302,253937194,3308745150,2758916275,583143000,2902153459,2539556926,1280225390,2856857022,61914911,2330727725,3158728348,97984948,696292259,1658451014,23610823,458820028,3438041907,2016971462,184559567,415734135,3404671686,341510860,3213593124,3690181420,2917824876,988616828,2792097966,172616667,2484964814,1782776747,2772879471,917589599,3863678251,3312761744,1817074862,2174452718,2096845949,2010720261,3709493035,615867934,922771230,671167337,360227416,1961976859,1227655348,131540395,2739399469,353827286,1766880951,84943819,4080554727,3994097696,4142462960,709123134,2579835922,1233354573,490696573,3071446068,4278583830,522893503,2224745515,1794089579,372624049,1167264926,3076067006,646216595,195105811,3220414216,1154424098,1212056221,2829113642,672554562,130155895,302431986,2567289946,101015763,2856340892,1452765768,1042778226,4286421687,1720229322,423439933,3797746204,1717284441,102232096,2107559111,3102438142,2480241276,1727676314,3560263120,3072432065,299548229,4050272832,2346663695,1472221924,1871216084,2401269723,3647046616,3777968689,1149224897,919885559,546795460,25387380,1569768399,2900595467,3546655751,1577869708,263398208,717075424,3369596978,2957114929,4124453784,966258904,122494748,501514125,2828210690,2638168498,2448193387,1056467409,2367172730,2198160229,813289895,3559160313,3610358949,1941189382,165951190,419875897,27340488,176036511,2418838057,2402547429,2594994124,2902680915,1228127524,458141875,2017111846,4219681413,278928087,1128894030,1494788929,1488530313,172274551,2937295863,3608633030,105657479,3345134273,2354043235,390445479,1610768806,403036207,632431395,1218039861,3937062951,1298977870,26938448,2221738786,2685023324,1146385342,3470290466,3024847863,59561302,1462546660,2463582234,1591849851,1043192127,1260064600,4233432276,874012976,839986165,4025316358,11834299,2852825840,314762793,3040324386,4013978287,806759004,1761899349,380572260,598279897,315683949,4152479697,4016629429,3311541656,3493748477,2191975255,304356596,3797027262,494522914,859917373,3051345082,144060047,3496866974,1938842046,4093310767,2040269978,3288621157,3541557439,491721284,2915521265,2946888551,2012711272,442453957,1031069754,3880754591,1737370919,762310080,1183318701,1677829300,352610996,59721928,206974172,3111835561,3640147308,3576381642,349275428,775245011,2569546238,34069244,697987897,2970758697,3618632218,1181311431,806071893,3941285385,1011776834,1730874415,2165171035,8925036,1793148745,67858643,1605823136,510367752,890786092,498871983,73057056,564139890,3006939646,1803935889,156236502,3804480245,980840311},
      {35051882,2078726591,319982642,53989527,2431047089,34706803,4222575867,3835457134,3442150737,1092228005,2858537337,3300994783,1221167061,3015338158,3322110233,3919946247,3823874516,1657983945,1404690646,15709954,3477555375,2387114477,1550820161,1948754921,2471734634,2858277274,1039063316,2079224092,2993274043,3036813083,3352935807,3514791193,997536218,3279572666,925745160,90178374,3526422909,176275261,346532392,3509512624,1885328092,352053533,412779056,361561797,364859739,4001278038,74427649,9156685,736790228,948029762,4117516998,2788360858,920976658,490455023,2599957177,3305968657,4063060070,3514150594,2491556268,2596917627,3154982601,2835722795,1848488630,3363324135,3515448627,4104393526,2301990670,3289011726,406619625,1186798423,4122737657,562794173,1850470362,3790125389,4118532229,224428987,266435191,268158889,4294051919,4160089243,3582632861,3528013568,3626620989,2822597807,506787313,2205499190,3466573990,2990116729,3566388890,3947495735,961232307,3596824987,1342421705,1210828578,343816483,3690496306,1391938532,1614865052,445458044,2478254494,1513183618,2229157778,2619465074,1820585882,4242721341,398857678,1748270273,3888349234,2810341724,3733460911,1813113712,2536648958,1672997983,1231947541,3013322997,192272376,3009344467,3657247878,3513117829,3810964683,1911524342,2075468111,2692827740,2517463728,3975297998,2391727745,906156361,450889916,3889118680,3197845335,18370709,2951317528,3865054300,2034824389,943122853,3686422582,4024566197,361256004,3811493169,280762157,1188061771,1557693927,192833257,2290551773,2234889722,1310930050,3644256815,2262349501,1879241453,751613474,2925223074,609859534,3520498291,659575021,3331854980,1213462618,1904519878,763952480,4232666472,2155127934,2549950717,941240091,618587076,2580481505,2957427091,642231463,983786070,3400275504,2417474274,2159537535,712064071,3405597643,1398444927,12710860,3506133741,1050264801,1866456106,2336479679,4286497098,1425550490,3979064237,1931356981,835661517,3553218905,387925103,1083980657,8071556,1460694764,584744420,1178644,105369421,3866559772,4097380001,3669737294,3535641138,560336325,672328640,1397059097,1841447801,2706326367,1620960446,599532549,4053731399,1962856021,1207552872,1887459793,2614639633,403853653,2900866357,2537661886,1669994459,103965562,3475429547,3730522204,2228628529,2743164757,80313928,768094253,2275331842,1857587570,3332758283,2556161683,1391433717,320715913,33404112,2969571178,1972522732,509865358,2351146377,3549955906,1684549938,1591992899,3703194441,2198249530,3900694607,3763070590,1930897416,1675582775,2265055467,1762990558,3390591451,2390584467,1148273064,3429388609,144434263,1440674462,1931879160,1456782307,452264276,719165059,93937020,1108478672,358787664,113668555,1434952831,33827179},
      {1318365142,883448950,4149148530,111468185,3740940280,1913635434,2021042584,239627405,375053177,2721619260,2786259230,343128575,1290982908,1799288631,286666855,1265223478,423091568,364645843,2440153757,1471785590,3140414735,3201314050,3968599489,1884820447,2833877788,637923410,3779173073,3452560116,214944194,2775111114,2400521295,3176566096,1543795064,99031410,1569163569,66694874,1372886428,2421634630,389078392,1286325048,1202614239,183866774,334823594,2870926845,2323726134,3537095027,521582329,1548012287,2087525124,3834982135,2923381321,1705490450,570799492,206163544,2335466879,2492682670,2547713673,225429887,2306342166,3364214627,92616437,668486896,264693029,315923114,697293897,4136768643,2940262829,227032327,1281074444,3568379514,1077537216,1332968120,3567040,1572462379,2078735530,1329695742,3613057213,3982485036,3535730627,208025543,70994583,64090669,1632365988,531294657,2995485950,2913235811,1951330957,270463778,1932871213,4148556677,566880571,117958499,1731052513,3348743831,4199227638,1109092793,269105240,2820242988,2048373563,3500055037,1090023125,3262790181,81611946,1512135139,2978217868,2128748855,1113985601,3433453594,1710613953,3809521699,2512859216,255633265,285157169,1746686919,734893173,1107844789,2400916950,3709918823,1313520622,860578531,2796229653,2191795358,439852157,3698850390,1207546835,289678894,87428128,2004932753,1845364854,3997884361,3185279345,51868261,3851395240,748049627,473011006,3776198803,3114534447,3393394526,2641131748,361962085,418645776,3145742296,3590746991,2663733078,2097479816,3341891634,423060641,1542095156,350848138,354695323,2712417989,2121087453,3620467033,2160387927,3603072729,4214039070,3626536288,1249098344,299007645,3219987004,1459842585,1237817819,885541860,108343883,344865177,1175469431,3646851683,2397884920,1352664310,2499732994,521234036,4203914284,838939806,3527928356,168267094,1512734278,3737961157,200446614,1202192756,3400656725,3139934401,2708079891,774460451,2981816713,2838936180,1782595266,868155856,2622018856,2013566240,470376440,990596367,2798863498,134540365,293954014,2236726056,3280526588,2935839653,289166958,2388335987,660024740,403792461,3972322234,1591848163,3261069338,1786581621,4056298147,2262243836,43344485,3463753188,2653017071,4092163574,3475551174,990447899,105589960,2690438916,1764614270,4202213416,2871282638,635166183,385987368,3401871918,3078293892,1450792103,972572458,1251285798,3898274421,232241028,256365906,4251071423,3200722168,1563681,4146125346,2684820219,2962260332,162034539,3975780225,3467381532,260589787,925590506,3045894875,1296684694,20708257,738976530,253971221,2523052075,3348211602,3700794237,515347524,612564617,4004128501,54816256,192023548,3253629441,646489087,4206983700,3283977972},
      {875533091,2825194762,1916897528,1351360421,834325101,310304014,3335176146,1349058467,621761320,404832732,1648754191,3789887502,2005766830,323365927,669381712,1206252899,4252719832,3093074525,3162761909,4092962193,2107525838,3399850125,3939675687,4037896424,1402465773,61514328,4157837547,1981744122,754997224,3042310352,1628472559,266460845,3819013364,2536781036,4107320505,4282342131,3883159328,3705481195,2873286034,2788535748,2167129230,4271762593,1913734334,2059016936,2957057147,1062384913,1704288146,50970713,1301441285,2663646727,1509365719,3210678098,415118779,914466195,4130865928,602324808,2470734080,1849335608,49061027,2460780984,3738258441,4226243979,3548280871,4065677646,383480979,763735978,1951447409,2151012832,1320429358,3758847389,443574294,1876452689,3352331734,157039276,1147183827,2253943960,3444119799,852863939,1230636970,665086553,3374560113,2130562502,3769431626,425898290,4152742964,1898618731,390096855,1552840366,309651089,1500299173,396987867,1867028468,887513362,2040489758,1414624112,90095063,2425864657,2958397253,3810079497,20725753,1541017082,1148261910,2373273765,3501350543,4068869917,23066570,155058732,531366563,1512765,97724269,346869661,2255993029,2624474697,1292316819,3415988947,2549084402,4074497156,2084513483,2694725056,998528724,1440295488,1961554272,22437195,827629320,2468528722,886256715,42441162,370268731,3497544568,1600689976,2598958857,3270416260,949487593,1213190744,941282644,4152061683,1927650480,1503355788,942891238,754393035,1882078026,191116886,1294525293,1945315177,1746954583,3545181344,3212846301,4222174787,228765059,1683474075,3894049844,270303090,3294155059,4105119749,266283352,3023649063,3057550054,3083438254,4265019323,3233375428,2852463101,2123493233,3496853761,116899004,3825094870,167538990,28476600,3691977215,719593613,2044852379,2830980082,2517432351,397658239,2760945509,3272072656,1170697959,1746312092,804821663,3931484019,4028998235,2547760915,3251996470,2101057797,1482167571,2411087239,393124047,2233757874,3044549717,2640034729,1396210627,4052222593,96467594,1770143998,1746097712,32549295,731070531,672798618,3459579340,1478658574,1862471051,3570245444,2187995263,683280778,3250733109,91991052,2312940142,3093197969,4078239870,3861873568,402797534,1999972657,3526359756,4069791042,2368443284,572970035,1737139684,430910664,226232869,4022911179,2452636366,366389469,213326100,3273736183,4222740052,882513171,3004733808,2338740570,3309983012,4173715141,1766332608,2195024310,365230547,351073740,775593287,183629530,1518421956,2913462037,131613152,95332876,3663160977,188929655,3785434256,36844594,940877771,53850857,1391465923,2238367714,1451517505,1789691261,644898207,3651557145,508478075,57828063,56939682,3379032867,3570638009},
      {171523927,3964560551,2459073694,1517043438,811693749,3575131264,1692414883,2486791718,2399747850,2738297578,3607816058,4033522356,285422338,1649651899,1485256716,2376573502,4131048471,1348939139,301808647,2772964154,3215631188,1058489034,211809594,1787184073,1642983250,3872533968,1159150206,96055141,4294142222,58129733,1488855255,1505559532,3705213757,1608748668,2338641772,1455347223,278165490,1938872245,3581073276,807037568,192064331,1060117901,220018824,336304608,730592794,658065554,3979694486,1697472700,1593937438,4165185815,216544430,3073413386,2847346197,3814969427,4235792354,1658970571,3232654331,3292667018,388142433,2266697936,3127748963,3926075210,60438846,3628781683,2473148500,2863127353,2701240078,3019131133,3425550225,581896181,404608662,2250784982,3239386156,1006477562,3528616518,2175191675,813860997,2962189272,1393289303,3352810723,2869150086,2107182105,3423088180,340538343,2398566356,4081472,1654446358,364092143,2482942901,3012058922,1270240544,2186474463,1683760497,4250764805,2232474178,1288619924,2496457347,1219593870,1651247122,1988920506,60574960,823054790,2820539112,2719996313,1271097215,1870668276,939320741,3826550717,2041768347,3799236968,3622115933,1405162178,3183595989,1601946009,1135193049,420463961,718178907,73434771,764698365,4189482381,3126045601,3742339585,1859083369,2102788216,1777586630,3831828855,3268073233,2817582783,2516831682,380868572,1971736386,4071458813,1701819407,3771678713,3642937123,4209058160,695026858,953917757,3720034305,4288525049,2171290981,665370196,1576717933,3364066848,2862747358,1279639637,4214925177,286895336,3476177560,4284769929,2329048717,2335275189,4234960584,1655588088,669311531,2214686427,2875867177,400766511,810594327,186018786,380203356,3212180441,2344912512,3750439113,3927719976,2332758008,2317672654,3050443740,1631059250,4038083243,2263537469,292575872,3477397094,3072729368,4023125591,2640454697,166656267,3479572721,3671468737,2127659523,1387317537,3473143961,3924851903,3473389323,893231252,1670716243,542481971,3403863825,1182929895,760536834,2573837822,2342343798,2787357769,1316919394,1530134532,1611142963,3349228184,819367698,4220736591,1111667947,3915898778,3967617902,997651862,2407468213,4209372040,683475063,1108736418,1122970009,183363385,835088,1005218863,2139753953,258327300,2056785507,629470164,3376248373,2766650227,1169950390,3437370233,288323732,1828347023,2074042313,409323298,70634145,2247425949,1135781864,1667851552,157964299,583582826,2597994234,305457122,474650281,3661845317,3524074704,2977626019,2505392647,4208759464,3427755052,1720485189,2311332297,1423872803,2908841253,320691281,2577961876,2322381386,3313850160,410215766,2304497908,2035432319,480610423,627326602,3666742271,406322875,1546141686,348322354,2739064107}
    };
  public:
    tabulation_hash() {
      num_tables = _num_tables;

      // if (num_tables <= 16)
      // {
      //   for (uint8_t i = 0; i < num_tables; i++)
      //   {
      //     for (uint16_t j = 0; j < std::numeric_limits<std::uint8_t>::max(); j++)
      //     {
      //       tabulation_tables[i][j].value = tabulation_values[i][j];
      //     }
      //   }
      // }
      // else
      // {
        std::random_device rd;
        std::mt19937 generator(rd());
        std::uniform_int_distribution<value_t> distribution(0, std::numeric_limits<value_t>::max());

        for (uint8_t i = 0; i < num_tables; i++)
        {
          for (uint16_t j = 0; j < std::numeric_limits<std::uint8_t>::max(); j++)
          {
            tabulation_tables[i][j].value = distribution(generator);
          }
        }
      // }
    }
    

    value_t get_hash(const std::string& key) override {
      // if (key.size() > sizeof(std::uint8_t)*num_tables) { // round robin instead
      //   throw std::invalid_argument("Key length is too big.");
      // }
      if (key.size() == 0) {
          throw std::invalid_argument("Key must not be empty.");
      }
      assert(sizeof(uint8_t) == sizeof(char));

      auto ukey = reinterpret_cast<const uint8_t*> (key.c_str());
      value_t hash_result = 0;
      for (uint8_t i = 0; i < key.size(); i++) {
        hash_result ^= tabulation_tables[i%num_tables][ukey[i]].value;
      }
      return hash_result;
    }
  };
}
#endif
